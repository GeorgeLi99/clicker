# 南京大学教室评价表自动填写程序

## 功能介绍

本程序用于自动填写南京大学的教室评价表，可以帮助用户快速完成以下操作：

- 自动登录评价系统页面（需手动输入用户名密码）
- 自动点击评价入口
- 自动处理所有教师的评价卡片
- 自动选择所有评价选项（除最后一个文本输入项）
- 自动提交评价表单并确认
- 自动处理所有助教的评价卡片（如果有）

## 快速开始

### 方法一：一键运行（推荐）

**新版本特性：更稳定、兼容性更好**

1. **双击运行** `run.bat` 文件
2. 程序会自动检查环境并安装依赖
3. 等待浏览器打开后，**手动输入学号密码登录**
4. 程序会自动完成评价过程

### 方法二：遇到任何问题时（一键修复）

如果遇到任何问题，可以使用一键修复工具：

1. **双击运行** `quick_fix.bat`
2. 工具会自动清理缓存、重装依赖、更新配置
3. 修复完成后重新运行 `run.bat`

### 方法三：专项诊断工具

针对特定问题的诊断工具：

| 问题类型    | 使用工具                  |
| ----------- | ------------------------- |
| 环境检查    | `diagnose.bat`            |
| 浏览器连接  | `test_browser_simple.bat` |
| 403权限错误 | `fix_403.bat`             |
| 自定义修复  | `fix.bat`                 |

### 方法四：诊断工具（遇到问题时使用）

如果需要详细了解问题原因：

1. **双击运行** `diagnose.bat`
2. 查看诊断结果，根据提示解决问题
3. 解决问题后重新运行 `run.bat`

## 环境要求

- **操作系统**：Windows 10/11
- **Python**：3.8或更高版本（脚本可自动提示安装）
- **浏览器**：Chrome浏览器（必须）
- **网络**：可访问南京大学校园网

## 详细安装说明

### 自动安装（推荐）

新版 `run.bat` 脚本特点：
- ✅ 简化安装流程，减少出错概率
- ✅ 自动检查Python、pip、Chrome等环境
- ✅ 智能错误提示和解决建议
- ✅ 支持断点续传，中断后可重新运行
- ✅ 自动创建配置文件

运行过程：
```
[1/4] 正在检查运行环境...
[2/4] 正在检查必要文件...
[3/4] 正在检查配置文件...
[4/4] 正在安装/检查依赖包...
```

### 手动安装

如果自动安装仍有问题：

1. **安装Python**
   - 访问：https://www.python.org/downloads/
   - 下载Python 3.8+版本
   - **重要**：安装时勾选 "Add Python to PATH"

2. **安装依赖**
   ```cmd
   pip install selenium webdriver-manager python-dotenv
   ```

3. **运行程序**
   ```cmd
   python main.py
   ```

## 故障排除

### 常见问题及解决方案

| 问题             | 解决方案                            |
| ---------------- | ----------------------------------- |
| 🔴 run.bat闪退    | 运行 `diagnose.bat` 检查环境        |
| 🔴 浏览器界面空白 | 运行 `test_browser_simple.bat` 诊断 |
| 🔴 登录后403错误  | 运行 `fix_403.bat` 专项修复         |
| 🔴 Python未找到   | 安装Python并勾选"Add to PATH"       |
| 🔴 Chrome无法启动 | 更新Chrome浏览器到最新版本          |
| 🔴 网络连接错误   | 检查校园网连接或VPN设置             |
| 🔴 权限错误       | 右键"以管理员身份运行"              |
| 🔴 杀毒软件拦截   | 临时关闭杀毒软件或添加白名单        |

### 详细诊断步骤

1. **运行诊断工具**
   ```cmd
   双击 diagnose.bat
   ```

2. **检查诊断结果**
   - ✅ 绿色勾号：正常
   - ❌ 红色错误：需要解决
   - ⚠️ 黄色警告：建议处理

3. **根据诊断结果操作**
   - Python问题：重新安装Python
   - Chrome问题：更新浏览器
   - 网络问题：检查网络连接
   - 权限问题：以管理员身份运行

### 高级故障排除

**问题：登录后403权限错误**

如果登录成功但出现403 Forbidden错误：

1. **快速修复**
   ```cmd
   # 运行专项修复工具
   双击 fix_403.bat
   ```

2. **常见原因分析**
   - **评价时间窗口**
     - 评价系统通常只在特定时间开放
     - 期中评价：学期第8-10周
     - 期末评价：学期第16-18周
     - 检查教务处最新通知
   
   - **URL时效性问题**
     - 评价系统URL包含时间戳等参数
     - 参数过期会导致403错误
     - 需要获取最新的URL
   
   - **账号权限限制**
     - 某些账号可能没有评价权限
     - 研究生/本科生权限不同
     - 交换生等特殊身份可能无权限

3. **手动解决步骤**
   ```cmd
   # 步骤1：获取最新URL
   1. 访问 https://ehallapp.nju.edu.cn
   2. 登录后搜索"教学评价"
   3. 点击"本科教学评价"
   4. 复制地址栏完整URL
   5. 更新config.py中的LOGIN_URL
   
   # 步骤2：清理缓存
   双击 fix.bat → 选择选项 4
   
   # 步骤3：重新运行
   双击 run.bat
   ```

4. **验证评价时间**
   - 访问南京大学教务处官网
   - 查看"教学评价"相关通知
   - 确认当前是否在评价开放期内

**问题：在其他电脑上闪退**

可能原因及解决方案：

1. **环境变量问题**
   ```cmd
   # 检查Python路径
   where python
   where pip
   ```

2. **权限问题**
   - 右键 run.bat → "以管理员身份运行"
   - 或者将项目文件夹移到用户目录下

3. **系统编码问题**
   - 确保系统支持UTF-8编码
   - 或在控制面板→区域→管理→更改系统区域设置

4. **依赖冲突**
   ```cmd
   # 清理pip缓存
   pip cache purge
   
   # 重新安装依赖
   pip install --force-reinstall selenium webdriver-manager
   ```

**问题：浏览器界面空白**

如果run.bat运行后浏览器打开但显示空白页面：

1. **快速诊断**
   ```cmd
   # 运行浏览器测试工具
   双击 test_browser_simple.bat
   ```

2. **常见原因及解决方案**
   - **Chrome驱动版本不匹配**
     ```cmd
     # 清理驱动缓存
     双击 fix.bat → 选择选项 2
     ```
   
   - **网络连接问题**
     - 确保可以访问南京大学校园网
     - 检查VPN连接是否正常
     - 尝试访问 https://authserver.nju.edu.cn
   
   - **Chrome浏览器问题**
     - 更新Chrome到最新版本
     - 清除Chrome缓存和Cookie
     - 禁用Chrome扩展程序
   
   - **防火墙/杀毒软件拦截**
     - 临时关闭防火墙和杀毒软件
     - 将程序添加到白名单

3. **深度排查**
   ```cmd
   # 完整环境诊断
   双击 diagnose.bat
   
   # 查看详细日志
   打开 logs/ 目录查看日志文件
   ```

## 程序使用说明

### 运行流程

1. **启动程序**：运行 `run.bat`
2. **环境检查**：自动检查并安装依赖
3. **浏览器启动**：自动打开Chrome并进入登录页
4. **手动登录**：输入学号密码，点击登录
5. **自动评价**：程序自动完成所有评价
6. **结束程序**：按任意键退出

### 注意事项

- 🔒 **安全性**：程序不会保存或上传任何个人信息
- 🔄 **自动重试**：遇到网络问题会自动重试
- 📝 **日志记录**：所有操作都会记录在 `logs/` 目录
- ⏸️ **可中断**：可随时关闭程序，不会影响系统

## 更新日志

### v2.0 (最新版本)
- ✨ 全新的 run.bat 脚本，更稳定可靠
- 🔧 增加诊断工具 diagnose.bat
- 🚀 简化安装流程，减少闪退问题
- 🛡️ 增强错误处理和用户提示
- 📊 详细的环境检查和故障排除

### v1.0
- 基础功能实现
- 自动评价教师和助教

## 技术支持

如遇问题，请提供以下信息：

1. 运行 `diagnose.bat` 的完整输出
2. `logs/` 目录下的日志文件
3. 操作系统版本和Python版本
4. 错误截图或错误信息

## 开源协议

本项目遵循 MIT 开源协议，仅供学习交流使用。 